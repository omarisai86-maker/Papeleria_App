<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Papeler铆a App</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        input, button { padding: 8px; margin: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #f0f0f0; }
        #reader { width: 300px; margin-top: 20px; }
        .vendido { background-color: #d4edda; }
    </style>
</head>
<body>

<h2> Papeler铆a - Lista de Faltantes</h2>

<button onclick="iniciarCamara()"> Escanear C贸digo</button>

<div id="reader"></div>

<h3>Agregar Producto</h3>

<input type="text" id="codigo" placeholder="C贸digo">
<input type="text" id="nombre" placeholder="Nombre">
<input type="number" id="precioCompra" placeholder="Precio Compra">
<input type="number" id="porcentaje" placeholder="% Ganancia">
<input type="number" id="precioVenta" placeholder="Precio Venta" readonly>

<button onclick="agregarProducto()">Agregar</button>

<table>
    <thead>
        <tr>
            <th>C贸digo</th>
            <th>Nombre</th>
            <th>Compra</th>
            <th>%</th>
            <th>Venta</th>
            <th>Acci贸n</th>
        </tr>
    </thead>
    <tbody id="tabla"></tbody>
</table>

<!--  Sonido escaneo -->
<audio id="beep">
    <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg">
</audio>

<script>
let productos = JSON.parse(localStorage.getItem("productos")) || [];

function guardarLocal() {
    localStorage.setItem("productos", JSON.stringify(productos));
}

function renderizar() {
    const tabla = document.getElementById("tabla");
    tabla.innerHTML = "";

    productos.forEach((p, index) => {
        tabla.innerHTML += `
            <tr>
                <td>${p.codigo}</td>
                <td>${p.nombre}</td>
                <td>$${p.compra}</td>
                <td>${p.porcentaje}%</td>
                <td>$${p.venta}</td>
                <td>
                    <button onclick="eliminarProducto(${index})"> Comprado</button>
                </td>
            </tr>
        `;
    });
}

function agregarProducto() {
    const codigo = document.getElementById("codigo").value;
    const nombre = document.getElementById("nombre").value;
    const compra = parseFloat(document.getElementById("precioCompra").value);
    const porcentaje = parseFloat(document.getElementById("porcentaje").value);

    if (!codigo || !nombre || !compra || !porcentaje) {
        alert("Completa todos los campos");
        return;
    }

    const venta = compra + (compra * porcentaje / 100);

    productos.push({
        codigo,
        nombre,
        compra,
        porcentaje,
        venta: venta.toFixed(2)
    });

    guardarLocal();
    renderizar();
    limpiarCampos();
}

function eliminarProducto(index) {
    productos.splice(index, 1);
    guardarLocal();
    renderizar();
}

function limpiarCampos() {
    document.getElementById("codigo").value = "";
    document.getElementById("nombre").value = "";
    document.getElementById("precioCompra").value = "";
    document.getElementById("porcentaje").value = "";
    document.getElementById("precioVenta").value = "";
}

document.getElementById("precioCompra").addEventListener("input", calcularVenta);
document.getElementById("porcentaje").addEventListener("input", calcularVenta);

function calcularVenta() {
    const compra = parseFloat(document.getElementById("precioCompra").value);
    const porcentaje = parseFloat(document.getElementById("porcentaje").value);

    if (compra && porcentaje) {
        const venta = compra + (compra * porcentaje / 100);
        document.getElementById("precioVenta").value = venta.toFixed(2);
    }
}

/*  CAMARA FUNCIONANDO */
let scanner;

function iniciarCamara() {
    scanner = new Html5Qrcode("reader");

    Html5Qrcode.getCameras().then(devices => {
        if (devices && devices.length) {
            const cameraId = devices[0].id;

            scanner.start(
                cameraId,
                {
                    fps: 10,
                    qrbox: 250
                },
                codigo => {
                    document.getElementById("codigo").value = codigo;
                    document.getElementById("beep").play(); //  sonido
                    scanner.stop();
                },
                error => {}
            );
        }
    }).catch(err => {
        alert("No se pudo acceder a la c谩mara");
    });
}

renderizar();
</script>

</body>
</html>
